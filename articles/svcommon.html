<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast Inference for Common-Factor Stochastic Volatility Models â€¢ svcommon</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fast Inference for Common-Factor Stochastic Volatility Models">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">svcommon</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/svcommon.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/factor_model.html">Efficient Computations for a Gaussian Factor Model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlysy/svcommon/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fast Inference for Common-Factor Stochastic Volatility Models</h1>
                        <h4 data-toc-skip class="author"><div class="line-block">Martin Lysy<br>
University of Waterloo</div></h4>
            
            <h4 data-toc-skip class="date">2024-09-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mlysy/svcommon/blob/master/vignettes/svcommon.Rmd" class="external-link"><code>vignettes/svcommon.Rmd</code></a></small>
      <div class="hidden name"><code>svcommon.Rmd</code></div>

    </div>

    
    
<!-- <\!-- equation numbering -\-> -->
<!-- <script type="text/x-mathjax-config"> -->
<!-- MathJax.Hub.Config({ -->
<!--   TeX: { equationNumbers: { autoNumber: "AMS" } } -->
<!-- }); -->
<!-- </script> -->
<!-- latex macros -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      TeX: {
      Macros: {
          bm: ["\\boldsymbol{#1}",1],
          tx: ["\\textrm{#1}",1],
          rv: ["#2_{#1},\\ldots,#2_{#3}",3,"1"],
          iid: ["\\overset{\\;\\tx{iid}\\;}{\\sim}"],
          ind: ["\\overset{\\:\\tx{ind}\\:}{\\sim}"],
          var: ["\\operatorname{var}"],
          cov: ["\\operatorname{cov}"],
          cor: ["\\operatorname{cor}"],
          logit: ["\\operatorname{logit}"],
          ilogit: ["\\operatorname{ilogit}"],
          N: ["\\mathcal{N}"],
          elL: ["\\mathcal{L}"],
          elap: ["\\ell_{\\text{Lap}}"],
          ud: ["\\mathop{}\\!\\mathrm{d}"],
          der: ["\\frac{\\ud^{#1}}{\\ud{#2}^{#1}}", 2, ""],
          del: ["\\frac{\\partial^{#1}}{\\partial{#2}^{#1}}", 2, ""],
          fder: ["\\frac{\\ud^{#1}#3}{\\ud{#2}^{#1}}", 3, ""],
          fdel: ["\\frac{\\partial^{#1}#3}{\\partial{#2}^{#1}}", 3, ""],
          hess: ["\\frac{\\partial^2}{\\partial{#1}\\partial{#1}'}", 1],
          fhess: ["\\frac{\\partial^2#2}{\\partial{#1}\\partial{#1}'}", 2],
          ww: ["{\\bm{w}}"],
          xx: ["{\\bm{x}}"],
          yy: ["{\\bm{y}}"],
          zz: ["{\\bm{z}}"],
          VV: ["{\\bm{V}}"],
          XX: ["{\\bm{X}}"],
          YY: ["{\\bm{Y}}"],
          ZZ: ["{\\bm{Z}}"],
          aal: ["{\\bm{\\alpha}}"],
          bbe: ["{\\bm{\\beta}}"],
          gga: ["{\\bm{\\gamma}}"],
          eet: ["{\\bm{\\eta}}"],
          lla: ["{\\bm{\\lambda}}"],
          mmu: ["{\\bm{\\mu}}"],
          pph: ["{\\bm{\\phi}}"],
          pps: ["{\\bm{\\psi}}"],
          rrh: ["{\\bm{\\rho}}"],
          ssi: ["{\\bm{\\sigma}}"],
          tta: ["{\\bm{\\tau}}"],
          tth: ["{\\bm{\\theta}}"],
          GGa: ["{\\bm{\\Gamma}}"],
          SSi: ["{\\bm{\\Sigma}}"],
          TTh: ["{\\bm{\\Theta}}"]
      }
      }
  });
</script><div class="section level2">
<h2 id="the-common-factor-multivariate-stochastic-volatility-model">The Common-Factor Multivariate Stochastic Volatility Model<a class="anchor" aria-label="anchor" href="#the-common-factor-multivariate-stochastic-volatility-model"></a>
</h2>
<p>Let <span class="math inline">\(X_{it}\)</span> denote the log price of asset <span class="math inline">\(i = 1,\ldots N_a\)</span> at time <span class="math inline">\(t\)</span> and <span class="math inline">\(V_{it}\)</span> denote the corresponding volatility on the standard deviation scale. The common-factor multivariate stochastic volatility (mSV) model proposed by <span class="citation">Fang <em>et al.</em> (<a href="#ref-fang.etal20">2020</a>)</span> is marginally written as
<span class="math display" id="eq:svuni">\[\begin{equation}
\begin{aligned}
\ud \log V_{it} &amp; = -\gamma_i (\log V_{it} - \mu_i) \ud t + \sigma_i \ud B_{it}^V \\
\ud X_{it} &amp; = (\alpha_i - \tfrac 1 2 V_{it}^2) \ud t + V_{it} \left(\rho_i \ud B_{it}^V + \sqrt{1 - \rho_i^2} \ud B_{it}^Z\right).
\end{aligned}
\tag{1}
\end{equation}\]</span>
The correlation between assets and volatilities comes from factor models for both the assets and the volatilities, namely
<span class="math display" id="eq:cor">\[\begin{equation}
\begin{aligned}
\ud B_{it}^V &amp; = \tau_i \ud B_{\star t}^V + \sqrt{1 - \tau_i^2} \ud B_{it}^\epsilon \\
\ud B_{it}^Z &amp; = \omega_i \ud B_{\star t}^Z + \sqrt{1 - \omega_i^2} \ud B_{it}^\eta.
\end{aligned}
\tag{2}
\end{equation}\]</span>
In <span class="citation">Fang <em>et al.</em> (<a href="#ref-fang.etal20">2020</a>)</span> it is suggested to estimate the volatility common innovation factor <span class="math inline">\(B_{\star t}^{V}\)</span> via an observable proxy, for example the VIX. That is, if <span class="math inline">\(V_{\star t}\)</span> is an observable proxy for the common volatility factor, then we use it to estimate <span class="math inline">\(B_{\star t}^V\)</span> via
<span class="math display" id="eq:volproxy">\[\begin{equation}
\ud \log V_{\star t} = -\gamma_{\star} (\log V_{\star t} - \mu_{\star}) \ud t + \sigma_{\star} \ud B_{\star t}^V.
\tag{3}
\end{equation}\]</span>
Here we propose to do something similar for the asset common innovation factor <span class="math inline">\(B_{\star t}^Z\)</span>. That is, let <span class="math inline">\((X_{0t}, V_{0t})\)</span> be a univariate stochastic volatility model for an observable proxy for the common asset factor (for example, SPX). Then we give it a similar marginal model to the above:
<span class="math display" id="eq:assetproxy">\[\begin{equation}
\begin{aligned}
\ud \log V_{0t} &amp; = -\gamma_0 (\log V_{0t} - \mu_0) \ud t + \sigma_0 \ud B_{0t}^V \\
\ud X_{0t} &amp; = (\alpha_0 - \tfrac 1 2 V_{0t}^2) \ud t + V_{0t} \left(\rho_0 \ud B_{0 t}^V + \sqrt{1 - \rho_0^2} \ud B_{0t}^Z \right),
\end{aligned}
\tag{4}
\end{equation}\]</span>
where <span class="math inline">\(\ud B_{0t}^V = \tau_0 \ud B_{\star t}^V + \sqrt{1 - \tau_0^2} \ud B_{0t}^\epsilon\)</span>. The asset common factor is estimated from the proxy by equating <span class="math inline">\(B_{\star t}^Z = B_{0t}^Z\)</span>.</p>
</div>
<div class="section level2">
<h2 id="parameter-estimation">Parameter Estimation<a class="anchor" aria-label="anchor" href="#parameter-estimation"></a>
</h2>
<p>The common-factor stochastic volatility model defined by <a href="#eq:svuni">(1)</a> through <a href="#eq:assetproxy">(4)</a> has likelihood function
<span class="math display">\[
\elL(\tth \mid \XX, \VV_0) \propto \int p(\XX, \VV, \VV_0 \mid \tth) \ud \VV.
\]</span>
While the integral over the latent volatilities <span class="math inline">\(\VV\)</span> is typically intractable, <strong>svcommon</strong> uses Laplaceâ€™s method to approximate the integral by solving a tractable optimization problem. This is implemented using the R package <strong>TMB</strong>, which efficiently computes the approximate marginal loglikelihood
<span class="math display" id="eq:elap">\[\begin{equation}
\elap(\tth \mid \XX, \VV_0) \approx \log \elL(\tth \mid \XX, \VV_0)
\tag{5}
\end{equation}\]</span>
and its gradient <span class="math inline">\(\frac{\partial}{\partial \tth} \elap(\tth \mid \XX, \VV_0)\)</span> using automatic differentiation. <strong>svcommon</strong> uses a block coordinate descent algorithm with good initial values to very quickly converge to the approximate MLE <span class="math inline">\(\hat \tth = \operatorname{arg\,max}_{\tth} \elap(\XX, \VV_0 \mid \tth)\)</span>, about two orders of magnitude faster than exact inference methods. The procedure is illustrated with a dataset consisting of 3408 daily closing prices of 46 constituents of the S&amp;P500, the index value itself (GSPC), and its volatility index (VIX).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># required packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlysy/svcommon" class="external-link">svcommon</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://mvtnorm.R-forge.R-project.org" class="external-link">mvtnorm</a></span><span class="op">)</span> <span class="co"># multivariate normal draws</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># data frame manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># plotting</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">snp500</span><span class="op">)</span> <span class="co"># automatically loaded with svcommon</span></span>
<span><span class="co">#&gt; [1] 3408   48</span></span>
<span><span class="va">snp500</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">snp500</span><span class="op">)</span><span class="op">-</span><span class="fl">8</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="co">#&gt;        MRK      PFE      ABT      UNH      CVS      BMY    GSPC   VIX</span></span>
<span><span class="co">#&gt; 1 26.72457 18.33346 10.54715 28.65658 16.81109 13.58980 1091.23 16.96</span></span>
<span><span class="co">#&gt; 2 27.11290 18.48489 10.62487 28.95242 16.89979 13.76582 1098.35 16.00</span></span>
<span><span class="co">#&gt; 3 27.19528 18.43247 10.59119 28.68308 16.84911 13.67195 1095.68 15.88</span></span>
<span><span class="co">#&gt; 4 27.27176 18.36258 10.62228 28.69191 17.07720 13.64260 1096.19 15.33</span></span>
<span><span class="co">#&gt; 5 27.07761 18.58389 10.73887 28.77579 17.15745 13.94773 1104.96 14.98</span></span>
<span><span class="co">#&gt; 6 26.50687 18.81684 10.67928 28.83320 17.19124 13.94773 1105.09 14.91</span></span></code></pre></div>
<div class="section level3">
<h3 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h3>
<p>Initial guesses for the parameters of the common-factor stochastic volatility (SVC) model are obtained from marginal fits of the exponential Ornstein-Uhlenbeck (EOU) model to each asset and to GSPC. To perform the optimization, the R built-in <strong>stats</strong> package provides the optimiziers <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim()</a></code>, <code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">stats::nlm()</a></code>, and <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code>. Various experiments with SVC modeling indicate that <code>statss:nlminb()</code> is by far the fastest, with little difference in numerical accuracy. Indeed, the marginal fits are extremely fast and stable, even with the (log or logit) parameters arbitrarily initialized to zero.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># problem dimensions</span></span>
<span><span class="va">nobs</span> <span class="op">&lt;-</span> <span class="fl">1000</span> <span class="co"># number of days</span></span>
<span><span class="va">nasset</span> <span class="op">&lt;-</span> <span class="fl">5</span> <span class="co"># number of assets, excluding GSPC</span></span>
<span></span>
<span><span class="co"># format the data</span></span>
<span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">252</span></span>
<span><span class="va">Xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>GSPC <span class="op">=</span> <span class="va">snp500</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">nobs</span>, <span class="st">"GSPC"</span><span class="op">]</span>,</span>
<span>                      <span class="va">snp500</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">nobs</span>, <span class="fl">1</span><span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="va">nasset</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Xt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Xt</span><span class="op">)</span></span>
<span><span class="va">log_VPt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">snp500</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">nobs</span>, <span class="st">"VIX"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize latent variables with rolling window standard deviations</span></span>
<span><span class="va">log_Vt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">Xt</span>, <span class="fl">2</span>, <span class="va">sv_init</span>, dt <span class="op">=</span> <span class="va">dt</span>, block_size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># initialize parameters with default values</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nasset</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">log_gamma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nasset</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nasset</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">log_sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nasset</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">logit_rho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nasset</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">logit_tau</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nasset</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">logit_omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">nasset</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># parameter and latent variable list for convenient updating</span></span>
<span><span class="va">curr_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log_Vt <span class="op">=</span> <span class="va">log_Vt</span>,</span>
<span>                 alpha <span class="op">=</span> <span class="va">alpha</span>,</span>
<span>                 log_gamma <span class="op">=</span> <span class="va">log_gamma</span>,</span>
<span>                 mu <span class="op">=</span> <span class="va">mu</span>,</span>
<span>                 log_sigma <span class="op">=</span> <span class="va">log_sigma</span>,</span>
<span>                 logit_rho <span class="op">=</span> <span class="va">logit_rho</span>,</span>
<span>                 logit_tau <span class="op">=</span> <span class="va">logit_tau</span>,</span>
<span>                 logit_omega <span class="op">=</span> <span class="va">logit_omega</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># optimization control parameters</span></span>
<span><span class="va">opt_control</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>eval.max <span class="op">=</span> <span class="fl">1000</span>, iter.max <span class="op">=</span> <span class="fl">1000</span>, trace <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize parameters of each individual asset</span></span>
<span><span class="va">tm_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">iasset</span> <span class="kw">in</span> <span class="fl">0</span><span class="op">:</span><span class="va">nasset</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"asset = "</span>, <span class="va">iasset</span><span class="op">)</span></span>
<span>    <span class="co"># construct model object</span></span>
<span>    <span class="va">eou_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eou_MakeADFun.html">eou_MakeADFun</a></span><span class="op">(</span>Xt <span class="op">=</span> <span class="va">Xt</span><span class="op">[</span>,<span class="va">iasset</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>, dt <span class="op">=</span> <span class="va">dt</span>,</span>
<span>                            alpha <span class="op">=</span> <span class="va">curr_par</span><span class="op">$</span><span class="va">alpha</span><span class="op">[</span><span class="va">iasset</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                            log_Vt <span class="op">=</span> <span class="va">curr_par</span><span class="op">$</span><span class="va">log_Vt</span><span class="op">[</span>,<span class="va">iasset</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                            log_gamma <span class="op">=</span> <span class="va">curr_par</span><span class="op">$</span><span class="va">log_gamma</span><span class="op">[</span><span class="va">iasset</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            mu <span class="op">=</span> <span class="va">curr_par</span><span class="op">$</span><span class="va">mu</span><span class="op">[</span><span class="va">iasset</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            log_sigma <span class="op">=</span> <span class="va">curr_par</span><span class="op">$</span><span class="va">log_sigma</span><span class="op">[</span><span class="va">iasset</span><span class="op">+</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                            logit_rho <span class="op">=</span> <span class="va">curr_par</span><span class="op">$</span><span class="va">logit_rho</span><span class="op">[</span><span class="va">iasset</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="co"># optimize with quasi-newton method</span></span>
<span>    <span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">eou_ad</span><span class="op">$</span><span class="va">par</span>,</span>
<span>                    objective <span class="op">=</span> <span class="va">eou_ad</span><span class="op">$</span><span class="va">fn</span>,</span>
<span>                    gradient <span class="op">=</span> <span class="va">eou_ad</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>                    control <span class="op">=</span> <span class="va">opt_control</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Time: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tm</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">" seconds"</span><span class="op">)</span></span>
<span>    <span class="co"># update parameters</span></span>
<span>    <span class="va">curr_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svc_update.html">svc_update</a></span><span class="op">(</span><span class="va">eou_ad</span>, old_par <span class="op">=</span> <span class="va">curr_par</span>, iasset <span class="op">=</span> <span class="va">iasset</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Total Time: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tm_tot</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">" seconds."</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="blockwise-coordinate-descent">Blockwise Coordinate Descent<a class="anchor" aria-label="anchor" href="#blockwise-coordinate-descent"></a>
</h3>
<p>The following algorithm updates the parameters for each asset conditioned on the values of all the others. Note that the Laplace approximation in this case depends only on the latent volatilities of the given asset and that of the asset common factor. Thus, <strong>svcommon</strong> removes the other volatilities from the gradient calculations, which considerably speeds up the calculations.</p>
<p>Here, <code>nepoch</code> denotes the number of cycles through all assets. For this dataset it appears that after <code>nepoch = 3</code> the parameter values are changing very little.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nepoch</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span></span>
<span><span class="va">tm_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">iepoch</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nepoch</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"epoch = "</span>, <span class="va">iepoch</span><span class="op">)</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">iasset</span> <span class="kw">in</span> <span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="va">nasset</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"asset = "</span>, <span class="va">iasset</span><span class="op">)</span></span>
<span>      <span class="va">svc_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svc_MakeADFun.html">svc_MakeADFun</a></span><span class="op">(</span>Xt <span class="op">=</span> <span class="va">Xt</span>, log_VPt <span class="op">=</span> <span class="va">log_VPt</span>, dt <span class="op">=</span> <span class="va">dt</span>,</span>
<span>                              par_list <span class="op">=</span> <span class="va">curr_par</span>,</span>
<span>                              iasset <span class="op">=</span> <span class="va">iasset</span><span class="op">)</span></span>
<span>      <span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">svc_ad</span><span class="op">$</span><span class="va">par</span>,</span>
<span>                      objective <span class="op">=</span> <span class="va">svc_ad</span><span class="op">$</span><span class="va">fn</span>,</span>
<span>                      gradient <span class="op">=</span> <span class="va">svc_ad</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>                      control <span class="op">=</span> <span class="va">opt_control</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Time: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tm</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">" seconds"</span><span class="op">)</span></span>
<span>      <span class="va">curr_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svc_update.html">svc_update</a></span><span class="op">(</span><span class="va">svc_ad</span>, old_par <span class="op">=</span> <span class="va">curr_par</span>, iasset <span class="op">=</span> <span class="va">iasset</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Total Time: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tm_tot</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">" seconds."</span><span class="op">)</span></span></code></pre></div>
<p>For good measure, letâ€™s finish with a joint optimization over all parameters. This should be comparatively fast now that the optimizer has good starting values<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># joint parameter optimization</span></span>
<span><span class="va">iasset</span> <span class="op">&lt;-</span> <span class="st">"all"</span></span>
<span><span class="va">svc_ad</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svc_MakeADFun.html">svc_MakeADFun</a></span><span class="op">(</span>Xt <span class="op">=</span> <span class="va">Xt</span>, log_VPt <span class="op">=</span> <span class="va">log_VPt</span>, dt <span class="op">=</span> <span class="va">dt</span>,</span>
<span>                        par_list <span class="op">=</span> <span class="va">curr_par</span>,</span>
<span>                        iasset <span class="op">=</span> <span class="va">iasset</span><span class="op">)</span></span>
<span><span class="va">tm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">opt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="va">svc_ad</span><span class="op">$</span><span class="va">par</span>,</span>
<span>                objective <span class="op">=</span> <span class="va">svc_ad</span><span class="op">$</span><span class="va">fn</span>,</span>
<span>                gradient <span class="op">=</span> <span class="va">svc_ad</span><span class="op">$</span><span class="va">gr</span>,</span>
<span>                control <span class="op">=</span> <span class="va">opt_control</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Time: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tm</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">" seconds"</span><span class="op">)</span></span>
<span><span class="va">curr_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/svc_update.html">svc_update</a></span><span class="op">(</span><span class="va">svc_ad</span>, old_par <span class="op">=</span> <span class="va">curr_par</span>, iasset <span class="op">=</span> <span class="va">iasset</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bayesian-estimation-and-forecasting">Bayesian Estimation and Forecasting<a class="anchor" aria-label="anchor" href="#bayesian-estimation-and-forecasting"></a>
</h3>
<p>Letâ€™s take a look at the parameter estimates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">svc_est</span> <span class="op">&lt;-</span> <span class="fu">TMB</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">sdreport</a></span><span class="op">(</span><span class="va">svc_ad</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">svc_est</span>, select <span class="op">=</span> <span class="st">"report"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>All parameter estimates have reasonable precision, except notably <span class="math inline">\(\alpha_i\)</span>, the long-term trend in asset <span class="math inline">\(i\)</span>, which is notoriously difficult to estimate. Also included are stimates of <span class="math inline">\(\log V_{iT}\)</span>, the latent volatility on the last day <span class="math inline">\(t = T\)</span> in the observed data. This can be useful for Bayesian forecasting, which can be conducted using the following method:</p>
<ol style="list-style-type: decimal">
<li><p>Let <span class="math inline">\(p(\tth, \log V_{0T}, \ldots, \log V_{qT} \mid \XX, \VV_0)\)</span> denote the posterior distribution of the parameters and terminal volatilities for <span class="math inline">\(q\)</span> assets and the common asset factor with the Lebesgue prior<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> <span class="math inline">\(\pi(\tth) \propto 1\)</span>. By the mode-quadrature approximation, this posterior is taken to be normal with mean and variance obtained from <code><a href="https://rdrr.io/pkg/TMB/man/sdreport.html" class="external-link">TMB::sdreport()</a></code>.</p></li>
<li><p>Let <span class="math inline">\(p(X_{0,T+d}, \ldots, X_{q,T+d}, \log V_{0,T+d}, \ldots, \log V_{q,T+d} \mid \XX, \VV_0)\)</span> denote the Bayesian forecast distribution for assets and volatilities on day <span class="math inline">\(t = T+d\)</span>. We can simulate from this distribution by combining draws from the multivariate normal approximation to <span class="math inline">\(p(\tth, \log V_{0T}, \ldots, \log V_{qT} \mid \XX, \VV_0)\)</span> with forward simulation from the SVC model with <code><a href="../reference/svc_sim.html">svc_sim()</a></code>.</p></li>
</ol>
<p>An illustration of this procedure produces the posterior forecast distribution in Figure <a href="#fig:forecast">1</a>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nfwd</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># number of days to forecast</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">1e4</span> <span class="co"># number of simulated forecasts</span></span>
<span></span>
<span><span class="co"># sample from the mode-quadrature approximation</span></span>
<span><span class="va">curr_post</span> <span class="op">&lt;-</span> <span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="va">nsim</span>,</span>
<span>                              mean <span class="op">=</span> <span class="va">svc_est</span><span class="op">$</span><span class="va">value</span>,</span>
<span>                              sigma <span class="op">=</span> <span class="va">svc_est</span><span class="op">$</span><span class="va">cov</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to appropriate inputs to svc_sim</span></span>
<span><span class="va">sim_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"log_gamma"</span>, <span class="st">"mu"</span>, <span class="st">"log_sigma"</span>, <span class="st">"logit_rho"</span>,</span>
<span>                       <span class="st">"logit_tau"</span>, <span class="st">"logit_omega"</span>, <span class="st">"log_VT"</span><span class="op">)</span>,</span>
<span>                     <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">curr_post</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">curr_post</span><span class="op">)</span> <span class="op">==</span> <span class="va">nm</span><span class="op">]</span><span class="op">)</span></span>
<span>                     <span class="op">}</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sim_args</span><span class="op">)</span><span class="op">[</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"log_V0"</span> <span class="co"># rename log_VT</span></span>
<span><span class="co"># remaining arguments</span></span>
<span><span class="va">sim_args</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sim_args</span>,</span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>X0 <span class="op">=</span> <span class="va">Xt</span><span class="op">[</span><span class="va">nobs</span>,<span class="op">]</span>,</span>
<span>                   log_VP0 <span class="op">=</span> <span class="va">log_VPt</span><span class="op">[</span><span class="va">nobs</span><span class="op">]</span>,</span>
<span>                   nobs <span class="op">=</span> <span class="va">nfwd</span>, dt <span class="op">=</span> <span class="va">dt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># forward simulation</span></span>
<span><span class="va">fwd_post</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">svc_sim</span>, args <span class="op">=</span> <span class="va">sim_args</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot posteriors on day t = nobs + nfwd</span></span>
<span><span class="co"># format data</span></span>
<span><span class="va">X_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fwd_post</span><span class="op">$</span><span class="va">Xt</span><span class="op">[</span><span class="va">nfwd</span>,,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X_fwd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Xt</span><span class="op">)</span></span>
<span><span class="va">X_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"X"</span>, <span class="va">X_fwd</span><span class="op">)</span></span>
<span><span class="va">V_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">fwd_post</span><span class="op">$</span><span class="va">log_Vt</span><span class="op">[</span><span class="va">nfwd</span>,,<span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">V_fwd</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">log_Vt</span><span class="op">)</span></span>
<span><span class="va">V_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"V"</span>, <span class="va">V_fwd</span><span class="op">)</span></span>
<span><span class="va">XV_fwd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">X_fwd</span>, <span class="va">V_fwd</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">XV_fwd</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">GSPC</span><span class="op">:</span><span class="va">USB</span>, names_to <span class="op">=</span> <span class="st">"Asset"</span>, values_to <span class="op">=</span> <span class="st">"Value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Asset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">Asset</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Xt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Value</span>, group <span class="op">=</span> <span class="va">Asset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">Asset</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">type</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Posterior Forecast Distribution"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<span style="display:block;" id="fig:forecast"></span>
<img src="svcommon_files/figure-html/forecast-1.png" alt="Posterior forecast distribution $p(\VV_{T+d} \mid \XX, \VV_0)$ and $p(\XX_{T+d} \mid \XX, \VV_0)$."><p class="caption">
Figure 1: Posterior forecast distribution <span class="math inline">\(p(\VV_{T+d} \mid \XX, \VV_0)\)</span> and <span class="math inline">\(p(\XX_{T+d} \mid \XX, \VV_0)\)</span>.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-fang.etal20" class="csl-entry">
Fang, Y., Lysy, M., and McLeish, D., 2020. Common-factor stochastic volatility modeling with observable proxy. <em>Canadian Journal of Statistics</em>, 48 (1), 36â€“61.
</div>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>For this particular dataset, it is possible to skip the initialization and blockwise coordinate descent steps, provided the <code>iter.max</code> parameter to <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb()</a></code> is large enough.<a href="#fnref1" class="footnote-back">â†©ï¸Ž</a></p></li>
<li id="fn2"><p>Since the prior is flat on the original scale but optimization is done on the transformed scale (<span class="math inline">\(\log \gamma_i\)</span>, <span class="math inline">\(\logit \rho_i\)</span>, etc.) the optimizer provides the correct Bayesian mode but a penalized maximum likelihood. SVC experiments indicate that penalization considerably improves the estimation of correlation parameters, which otherwise tend to drift off to boundary values.<a href="#fnref2" class="footnote-back">â†©ï¸Ž</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin Lysy.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
