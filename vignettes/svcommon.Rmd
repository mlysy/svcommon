---
title: "Fast Inference for Common-Factor Stochastic Volatility Models"
author: |
  | Martin Lysy
  | University of Waterloo
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{svcommon}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<!-- latex macros -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      TeX: {
	  Macros: {
	      bm: ["\\boldsymbol{#1}",1],
	      tx: ["\\textrm{#1}",1],
	      rv: ["#2_{#1},\\ldots,#2_{#3}",3,"1"],
	      iid: ["\\overset{\\;\\tx{iid}\\;}{\\sim}"],
	      ind: ["\\overset{\\:\\tx{ind}\\:}{\\sim}"],
	      var: ["\\operatorname{var}"],
	      cov: ["\\operatorname{cov}"],
	      cor: ["\\operatorname{cor}"],
	      N: ["\\mathcal{N}"],
	      ud: ["\\mathop{}\\!\\mathrm{d}"],
	      der: ["\\frac{\\ud^{#1}}{\\ud{#2}^{#1}}", 2, ""],
	      del: ["\\frac{\\partial^{#1}}{\\partial{#2}^{#1}}", 2, ""],
	      fder: ["\\frac{\\ud^{#1}#3}{\\ud{#2}^{#1}}", 3, ""],
	      fdel: ["\\frac{\\partial^{#1}#3}{\\partial{#2}^{#1}}", 3, ""],
	      hess: ["\\frac{\\partial^2}{\\partial{#1}\\partial{#1}'}", 1],
	      fhess: ["\\frac{\\partial^2#2}{\\partial{#1}\\partial{#1}'}", 2],
	      ww: ["{\\bm{w}}"],
	      xx: ["{\\bm{x}}"],
	      yy: ["{\\bm{y}}"],
	      zz: ["{\\bm{z}}"],
	      XX: ["{\\bm{X}}"],
	      YY: ["{\\bm{Y}}"],
	      ZZ: ["{\\bm{Z}}"],
	      aal: ["{\\bm{\\alpha}}"],
	      bbe: ["{\\bm{\\beta}}"],
	      gga: ["{\\bm{\\gamma}}"],
	      eet: ["{\\bm{\\eta}}"],
	      lla: ["{\\bm{\\lambda}}"],
	      mmu: ["{\\bm{\\mu}}"],
	      pph: ["{\\bm{\\phi}}"],
	      pps: ["{\\bm{\\psi}}"],
	      rrh: ["{\\bm{\\rho}}"],
	      ssi: ["{\\bm{\\sigma}}"],
	      tta: ["{\\bm{\\tau}}"],
	      tth: ["{\\bm{\\theta}}"],
	      GGa: ["{\\bm{\\Gamma}}"],
	      SSi: ["{\\bm{\\Sigma}}"],
	      TTh: ["{\\bm{\\Theta}}"]
	  }
      }
  });
</script>


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(svcommon)
```

# The Common-Factor Multivariate Stochastic Volatility Model

Let $X_{it}$ denote the log price of asset $i$ at time $t$ and $V_{it}$ denote the corresponding volatility on the standard deviation scale.  The common-factor multivariate stochastic volatility (mSV) model proposed by Fang et al (2020) is marginally written as
$$
\begin{aligned}
\ud \log V_{it} & = -\gamma_i (\log V_{it} - \mu_i) \ud t + \sigma_i \ud B_{it}^V \\
\ud X_{it} & = (\alpha_i - \tfrac 1 2 V_{it}^2) \ud t + V_{it} \left(\rho_i \ud B_{it}^V + \sqrt{1 - \rho_i^2} \ud B_{it}^Z\right).
\end{aligned}
$$
The correlation between assets and volatilities comes from factor models for both the assets and the volatilities, namely
$$
\begin{aligned}
\ud B_{it}^V & = \tau_i \ud B_{\star t}^V + \sqrt{1 - \tau_i^2} \ud B_{it}^\epsilon \\
\ud B_{it}^Z & = \omega_i \ud B_{\star t}^Z + \sqrt{1 - \omega_i^2} \ud B_{it}^\eta.
\end{aligned}
$$
In Fang et al (2020) it is suggested to estimate the volatility common innovation factor $B_{\star t}^{V}$ via an observable proxy, for example the VIX.  That is, if $V_{\star t}$ is an observable proxy for the common volatility factor, then we use it to estimate $B_{\star t}^V$ via
$$
\ud \log V_{\star t} = -\gamma_{\star} (\log V_{\star t} - \mu_{\star}) \ud t + \sigma_{\star} \ud B_{\star t}^V.
$$
Here we propose to do something similar for the asset common innovation factor $B_{\star t}^Z$.  That is, let $(X_{0t}, V_{0t})$ be a univariate stochastic volatility model for an observable proxy for the common asset factor (for example, SPX).  Then we give it a similar marginal model to the above:
$$
\begin{aligned}
\ud \log V_{0t} & = -\gamma_0 (\log V_{0t} - \mu_0) \ud t + \sigma_0 \left(\tau_0 \ud B_{0t}^V + \sqrt{1 - \tau_0^2} \right)\\
\ud X_{0t} & = (\alpha_0 - \tfrac 1 2 V_{0t}^2) \ud t + V_{0t} \left(\rho_0 \ud B_{0 t}^Z + \sqrt{1 - \rho_0^2} \ud B_{0i}^\eta \right),
\end{aligned}
$$
where $\ud B_{0t}^V = \tau_0 \ud B_{\star t}^V + \sqrt{1 - \tau_0^2} \ud B_{0t}^\epsilon$.  The asset common factor is estimated from the proxy by equating $B_{\star t}^Z = B_{0t}^Z$.
